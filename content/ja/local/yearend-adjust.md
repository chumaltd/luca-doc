---
title: "所得税の年末調整"
date: 2026-01-30T15:33:27+09:00
---
所得税の年末調整
=============

年末調整のフローは、次の3段階です。

1. 年末調整申告データインポート
2. 年間所得税の計算
3. 給与支払報告データエクスポート


年末調整申告データインポート
-----------------
国税庁が提供する[年末調整控除申告書作成用アプリ](https://www.nta.go.jp/users/gensen/nenmatsu/nencho.htm)の出力データをインポートします。


### 前提

`luca-jp`の年末調整機能は給与計算データの自動入力を目的としています。  
申告書の保管はサポートしていません。ファイルまたは紙の保管は別途運用してください。

* アプリが出力するzipファイルをインポート対象とします
  * パスワード付きのzipはサポートしていません。あらかじめ解凍したディレクトリからはインポートできます。各個人のデータには複数のXMLファイルがあるため、ディレクトリは必要です
  * 電子署名付きデータはそのままインポート可能です
* インポートする個人に対応するLucaSalaryのプロファイルが、プロジェクトディレクトリの`data/s_profiles/`に存在している必要があります
  * プロファイルが見つからなかったインポートデータはリジェクトされます
  * `s_profiles/`は暗号化する個人情報を`profiles/`とは別に配置する想定のディレクトリです。自動で作成されません
* 個人番号にもとづいてLucaSalaryプロファイルと年末調整アプリのデータを照合します
  * アプリの操作時に本人と家族の個人番号を入力・エクスポートする必要があります
  * いずれかのデータが個人番号を持たない場合、氏名と生年月日の完全一致による照合を行います
  * これらの入力に不備がある場合、インポートできずリジェクトします。氏名照合にフォールバックする場合、異体字の表記揺れや改姓などの影響が考えられます


### インポート対象の申告書

現時点では、サポートしている申告書は一部です。

* 扶養控除等申告書
* 配偶者控除等申告書


### 操作

LucaSalaryのプロジェクトディレクトリで`luca-jp nenmatsu-chousei`サブコマンドを実行します。  
`data/s_profiles/`ディレクトリが存在している必要があるため、LucaSalaryの暗号化を利用している場合にはあらかじめ`luca-salary decrypt`で復号しておきます。

```bash
luca-jp nenmatsu[-chousei] <インポートpath> [IDの部分文字列]
```

1人分のデータをインポートするケースでは、`インポートpath`はzipファイルまたはそれを解凍したディレクトリです。絶対pathで指定した方が確実です。  
インポート時に個人の自動照合がうまく動作しない場合、`IDの部分文字列`を追加することで特定プロファイルに強制的に関連づけてインポートできます。このIDはLucaSalaryプロファイルの`id`です。

複数の人のデータをバルクインポートする場合には、`インポートpath`は複数のzipを含むディレクトリです。解凍したサブディレクトリを含んでいても動作します。

自動照合に失敗したzipファイルは標準エラー出力へのエラーメッセージとともに処理スキップし、`rejected/`ディレクトリに移動します。

インポートが完了したら必要に応じて`luca-salary encrypt`で暗号化してコミットします。


年間所得税の計算
-----------------

年末調整プロファイルにもとづいて、所得税の年額を計算します。

### 操作

LucaSalaryのプロジェクトディレクトリで`luca-salary payment total`サブコマンドを実行します。  
`s_profiles/`にも個人データを置く構成では、自動でプロファイルを統合します。LucaSalaryの暗号化を利用している場合にはあらかじめ`luca-salary decrypt`で復号しておきます。

```bash
luca-salary payment total <集計対象年>
```

`data/payments/total/`ディレクトリに年間集計データを生成します。

調整額を精算月の支払データに反映するには、`--adjust`オプション付きで次のコマンドを実行します。

```bash
luca-salary payment total --adjust <給与支払年> <月>
```

このコマンドは調整額を反映するもので、あらかじめ該当月の支払データが存在していることを前提としています。

LucaBookへの仕訳エクスポートも`--adjust`実行後のデータでは預り金で調整されています。


### 開発コメント

年間の通算調整じたいは広く各国に存在する想定により、この操作は`luca-salary`のサブコマンドに割り当てています。

実処理は各国特有の処理となるため、会社の国コード設定にもとづいて`luca-jp`の機能を呼び出しています。


給与支払報告データエクスポート
-----------------
eLTAXのPCDesk向けCSVをエクスポートします。

### 前提

* プロファイルの`resident.area_code`に自治体コードが必要です
* プロファイルの`resident.tax_id`に各自治体の識別番号が必要です
  * このコードは該当自治体に初回申請する場合には取得していません。設定なしのまま申告します。
    * 翌年の住民税の徴収通知の際に割り当てられています
    * eLTAXの仕様により識別番号がない場合には通知は紙になります
  * `resident.tax_id`は会社に割り当てられるIDであるため、個人のプロファイル設定は本来適切ではありません。将来は会社の設定に移動する予定です
* eLTAXの仕様上、個別の支払データはエクスポートできますが総額計算の機能がありません。集計のうえPCDeskに直接入力する必要があります。

次のようなeTaxから税務署に申告するデータには対応していません。

* 不動産の支払報告
* 報酬区分の支払調書

これらは、LucaBookの補助科目を活用して集計する方法が手軽でしょう。


### 操作

LucaSalaryのプロジェクトディレクトリで`luca-jp kyuyo`サブコマンドを実行します。  
データは標準出力に表示されるため、ファイル保存するには任意のpathにリダイレクトします。

```bash
luca-jp kyuyo <報告対象年> > export.csv
```

`s_profiles/`にも個人データを置く構成では、自動でプロファイルを統合します。LucaSalaryの暗号化を利用している場合にはあらかじめ`luca-salary decrypt`で復号しておきます。
