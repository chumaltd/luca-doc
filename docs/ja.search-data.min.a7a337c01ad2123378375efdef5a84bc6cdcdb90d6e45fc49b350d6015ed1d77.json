[{"id":0,"href":"/luca-doc/ja/local/yearend-adjust/","title":"所得税の年末調整","section":"日本ローカル機能","content":"所得税の年末調整# 年末調整のフローは、次の3段階です。\n年末調整申告データインポート 年間所得税の計算 給与支払報告データエクスポート 年末調整申告データインポート# 国税庁が提供する年末調整控除申告書作成用アプリの出力データをインポートします。\n前提# luca-jpの年末調整機能は給与計算データの自動入力を目的としています。\n申告書の保管はサポートしていません。ファイルまたは紙の保管は別途運用してください。\nアプリが出力するzipファイルをインポート対象とします パスワード付きのzipはサポートしていません。あらかじめ解凍したディレクトリからはインポートできます。各個人のデータには複数のXMLファイルがあるため、ディレクトリは必要です 電子署名付きデータはそのままインポート可能です インポートする個人に対応するLucaSalaryのプロファイルが、プロジェクトディレクトリのdata/s_profiles/に存在している必要があります プロファイルが見つからなかったインポートデータはリジェクトされます s_profiles/は暗号化する個人情報をprofiles/とは別に配置する想定のディレクトリです。自動で作成されません 個人番号にもとづいてLucaSalaryプロファイルと年末調整アプリのデータを照合します アプリの操作時に本人と家族の個人番号を入力・エクスポートする必要があります いずれかのデータが個人番号を持たない場合、氏名と生年月日の完全一致による照合を行います これらの入力に不備がある場合、インポートできずリジェクトします。氏名照合にフォールバックする場合、異体字の表記揺れや改姓などの影響が考えられます インポート対象の申告書# 現時点では、サポートしている申告書は一部です。\n扶養控除等申告書 配偶者控除等申告書 操作# LucaSalaryのプロジェクトディレクトリでluca-jp nenmatsu-chouseiサブコマンドを実行します。\ndata/s_profiles/ディレクトリが存在している必要があるため、LucaSalaryの暗号化を利用している場合にはあらかじめluca-salary decryptで復号しておきます。\nluca-jp nenmatsu[-chousei] \u0026lt;インポートpath\u0026gt; [IDの部分文字列] 1人分のデータをインポートするケースでは、インポートpathはzipファイルまたはそれを解凍したディレクトリです。絶対pathで指定した方が確実です。\nインポート時に個人の自動照合がうまく動作しない場合、IDの部分文字列を追加することで特定プロファイルに強制的に関連づけてインポートできます。このIDはLucaSalaryプロファイルのidです。\n複数の人のデータをバルクインポートする場合には、インポートpathは複数のzipを含むディレクトリです。解凍したサブディレクトリを含んでいても動作します。\n自動照合に失敗したzipファイルは標準エラー出力へのエラーメッセージとともに処理スキップし、rejected/ディレクトリに移動します。\nインポートが完了したら必要に応じてluca-salary encryptで暗号化してコミットします。\n年間所得税の計算# 年末調整プロファイルにもとづいて、所得税の年額を計算します。\n操作# LucaSalaryのプロジェクトディレクトリでluca-salary payment totalサブコマンドを実行します。\ns_profiles/にも個人データを置く構成では、自動でプロファイルを統合します。LucaSalaryの暗号化を利用している場合にはあらかじめluca-salary decryptで復号しておきます。\nluca-salary payment total \u0026lt;集計対象年\u0026gt; data/payments/total/ディレクトリに年間集計データを生成します。\n調整額を精算月の支払データに反映するには、--adjustオプション付きで次のコマンドを実行します。\nluca-salary payment total --adjust \u0026lt;給与支払年\u0026gt; \u0026lt;月\u0026gt; このコマンドは調整額を反映するもので、あらかじめ該当月の支払データが存在していることを前提としています。\nLucaBookへの仕訳エクスポートも--adjust実行後のデータでは預り金で調整されています。\n開発コメント# 年間の通算調整じたいは広く各国に存在する想定により、この操作はluca-salaryのサブコマンドに割り当てています。\n実処理は各国特有の処理となるため、会社の国コード設定にもとづいてluca-jpの機能を呼び出しています。\n給与支払報告データエクスポート# eLTAXのPCDesk向けCSVをエクスポートします。\n前提# プロファイルのresident.area_codeに自治体コードが必要です プロファイルのresident.tax_idに各自治体の識別番号が必要です このコードは該当自治体に初回申請する場合には取得していません。設定なしのまま申告します。 翌年の住民税の徴収通知の際に割り当てられています eLTAXの仕様により識別番号がない場合には通知は紙になります resident.tax_idは会社に割り当てられるIDであるため、個人のプロファイル設定は本来適切ではありません。将来は会社の設定に移動する予定です eLTAXの仕様上、個別の支払データはエクスポートできますが総額計算の機能がありません。集計のうえPCDeskに直接入力する必要があります。 次のようなeTaxから税務署に申告するデータには対応していません。\n不動産の支払報告 報酬区分の支払調書 これらは、LucaBookの補助科目を活用して集計する方法が手軽でしょう。\n操作# LucaSalaryのプロジェクトディレクトリでluca-jp kyuyoサブコマンドを実行します。\nデータは標準出力に表示されるため、ファイル保存するには任意のpathにリダイレクトします。\nluca-jp kyuyo \u0026lt;報告対象年\u0026gt; \u0026gt; export.csv s_profiles/にも個人データを置く構成では、自動でプロファイルを統合します。LucaSalaryの暗号化を利用している場合にはあらかじめluca-salary decryptで復号しておきます。\n"},{"id":1,"href":"/luca-doc/ja/concepts/automation/","title":"自動化","section":"コンセプト","content":"自動化# あらかじめロジックを定義できるデータの多くには自動化の余地があります。\n適切なルールに沿った均質なデータ処理によってビジネスの一貫性が強まり、事務的なミスも減らせます。\n限られた集中力をより重要でイレギュラーなプロセスに活用することが重要です。\nLucaSuiteの自動化アプローチ# LucaSuiteはシステムによる自動実行を実装しやすくするため、各ツールでCLIコマンドを提供しています。\n自動化フレームワークには、KubernetesネイティブのTektonや伝統的なcron、そのほか任意の各種CIツールを利用できます。\nサポートしている利用シナリオには以下のようなものがあります。\nLucaBook: 銀行の取引明細をCSVインポートして、仕訳記録 LucaBook: 最新のBS, PLをメール配信で通知 LucaBook: LucaDealの請求リストをインポートして、仕訳記録 LucaDeal: 月次請求リストにもとづいて請求データを作成 LucaDeal: 請求予定のリスト確認のためメール通知 LucaDeal: 請求データにもとづいて請求書PDFを取引先にメール送信 "},{"id":2,"href":"/luca-doc/ja/local/","title":"日本ローカル機能","section":"LucaSuite","content":"日本ローカル機能# 日本の実務特有の事務をサポートする機能は、Luca::Jpが提供しています。\nluca-jp gemをインストールすることで、CLIのluca-jpコマンドを用いてLucaSuiteのプロジェクトデータを操作できます。\n"}]